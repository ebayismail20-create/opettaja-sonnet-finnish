<!DOCTYPE html>
<html lang="fi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Finnish Lesson #{{LESSON_NUMBER}} - {{TOPIC}}</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&family=Merriweather:ital,wght@0,300;0,700;1,300&display=swap"
        rel="stylesheet">
    <style>
        :root {
            --fi-blue: #003580;
            --fi-white: #FFFFFF;
            --fi-light-blue: #e6f0ff;
            --text-main: #1a1a1a;
            --text-light: #666;
            --accent-success: #2e7d32;
            --accent-error: #d32f2f;
            --grammar-stem: #1b5e20;
            /* Green */
            --grammar-ending: #003580;
            /* Blue */
            --grammar-verb: #b71c1c;
            /* Red */
            --grammar-particle: #4a148c;
            /* Purple */
            --radius: 12px;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: #f4f6f8;
            color: var(--text-main);
            line-height: 1.6;
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Header */
        .header {
            background: linear-gradient(135deg, var(--fi-blue) 0%, #0044a0 100%);
            color: var(--fi-white);
            padding: 40px;
            border-radius: var(--radius);
            box-shadow: 0 10px 30px rgba(0, 53, 128, 0.2);
            position: relative;
            overflow: hidden;
            margin-bottom: 30px;
            text-align: center;
        }

        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(45deg, transparent 40%, rgba(255, 255, 255, 0.1) 40%, rgba(255, 255, 255, 0.1) 60%, transparent 60%);
            pointer-events: none;
        }

        .level-badge {
            background: var(--fi-white);
            color: var(--fi-blue);
            padding: 6px 16px;
            border-radius: 20px;
            font-weight: 800;
            font-size: 0.9rem;
            text-transform: uppercase;
            display: inline-block;
            margin-bottom: 15px;
            letter-spacing: 1px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }

        h1 {
            font-size: 2.5rem;
            font-weight: 800;
            margin-bottom: 10px;
            letter-spacing: -1px;
        }

        h2 {
            font-size: 1.2rem;
            font-weight: 400;
            opacity: 0.9;
            margin-bottom: 20px;
            font-family: 'Merriweather', serif;
            font-style: italic;
        }

        .date-display {
            font-size: 0.85rem;
            opacity: 0.7;
            position: absolute;
            top: 20px;
            right: 20px;
        }

        /* Sections */
        .card {
            background: var(--fi-white);
            border-radius: var(--radius);
            padding: 30px;
            margin-bottom: 25px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.04);
            transition: transform 0.2s;
            border: 1px solid rgba(0, 0, 0, 0.03);
        }

        .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.06);
        }

        .card-title {
            font-size: 1.4rem;
            font-weight: 700;
            color: var(--fi-blue);
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
            border-bottom: 2px solid var(--fi-light-blue);
            padding-bottom: 10px;
        }

        /* Mission Box */
        .mission-box {
            background: linear-gradient(to right, #e3f2fd, #ffffff);
            border-left: 5px solid var(--fi-blue);
        }

        .mission-text {
            font-size: 1.1rem;
            font-weight: 500;
        }

        /* Vocabulary Grid */
        .vocab-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 15px;
        }

        .vocab-item {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            border-left: 3px solid #ddd;
            display: flex;
            flex-direction: column;
            position: relative;
        }

        .vocab-item:hover {
            border-left-color: var(--fi-blue);
            background: #fff;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }

        .fi-word {
            font-weight: 800;
            font-size: 1.1rem;
            color: #333;
        }

        .pronunciation {
            font-size: 0.85rem;
            color: #666;
            font-family: monospace;
        }

        .en-meaning {
            margin-top: 5px;
            color: #444;
        }

        .trick-icon {
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 1.2rem;
            cursor: help;
        }

        /* Grammar Theater */
        .grammar-theater {
            background: #fafafa;
            padding: 20px;
            border-radius: 8px;
            border: 1px dashed #ccc;
            text-align: center;
            font-size: 1.2rem;
            margin: 20px 0;
        }

        .g-stem {
            color: var(--grammar-stem);
            font-weight: 700;
        }

        .g-ending {
            color: var(--grammar-ending);
            font-weight: 700;
        }

        .g-verb {
            color: var(--grammar-verb);
            font-weight: 700;
            text-decoration: underline;
            text-decoration-color: rgba(183, 28, 28, 0.3);
        }

        .g-particle {
            color: var(--grammar-particle);
            font-style: italic;
        }

        .rule-explanation {
            text-align: left;
            margin-top: 15px;
            font-size: 1rem;
            color: #555;
        }

        /* Interactive Toggle */
        .toggle-btn {
            background: none;
            border: none;
            color: var(--fi-blue);
            font-weight: 600;
            cursor: pointer;
            font-size: 0.9rem;
            text-decoration: underline;
            margin-top: 10px;
        }

        .hidden-content {
            display: none;
            margin-top: 10px;
            padding: 15px;
            background: #f0f4ff;
            border-radius: 8px;
        }

        /* Tricks Box */
        .tricks-box {
            background: #fffde7;
            border: 2px solid #fff9c4;
            position: relative;
        }

        .tricks-box::after {
            content: 'üí°';
            position: absolute;
            top: -15px;
            right: 20px;
            font-size: 2rem;
            background: #fffde7;
            padding: 0 10px;
        }

        /* Exercise Zone */
        .exercise-row {
            margin-bottom: 15px;
        }

        .ex-input {
            width: 100%;
            border: 2px solid #e0e0e0;
            padding: 12px;
            border-radius: 6px;
            font-family: inherit;
            transition: border-color 0.3s;
        }

        .ex-input:focus {
            outline: none;
            border-color: var(--fi-blue);
        }

        .ex-label {
            font-weight: 600;
            margin-bottom: 5px;
            display: block;
        }

        .check-btn {
            background: var(--fi-blue);
            color: white;
            border: none;
            padding: 8px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            margin-top: 5px;
            font-size: 0.9rem;
        }

        .check-btn:hover {
            background: #002a66;
        }

        /* Writing Lab */
        .writing-area {
            width: 100%;
            min-height: 150px;
            padding: 15px;
            border: 2px solid #eee;
            border-radius: 8px;
            resize: vertical;
            font-family: inherit;
        }

        /* Audio Player Placeholder */
        .audio-player {
            background: #e8f5e9;
            padding: 15px;
            border-radius: 30px;
            display: flex;
            align-items: center;
            gap: 15px;
            color: #2e7d32;
            font-weight: 600;
            cursor: pointer;
            border: 1px solid #c8e6c9;
        }

        /* Daily Test Accordion */
        .accordion-item {
            border-bottom: 1px solid #eee;
        }

        .accordion-header {
            padding: 15px 0;
            cursor: pointer;
            font-weight: 600;
            display: flex;
            justify-content: space-between;
        }

        .accordion-content {
            padding-bottom: 15px;
            display: none;
            color: #555;
        }

        /* Progress Footer */
        .progress-container {
            margin-top: 50px;
            text-align: center;
        }

        .progress-track {
            height: 8px;
            background: #e0e0e0;
            border-radius: 4px;
            overflow: hidden;
            margin: 15px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--fi-blue), #42a5f5);

            width: {
                    {
                    PROGRESS_PERCENT
                }
            }

            %;
        }

        .footer {
            text-align: center;
            color: #888;
            margin-top: 40px;
            font-size: 0.85rem;
            padding-bottom: 20px;
        }

        @media (max-width: 600px) {
            .header {
                padding: 20px;
            }

            h1 {
                font-size: 1.8rem;
            }

            .vocab-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>

<body>

    <div class="header">
        <div class="date-display">{{DATE}}</div>
        <div class="level-badge">{{LEVEL}}</div>
        <h1>Lesson #{{LESSON_NUMBER}}</h1>
        <h2>{{TOPIC}}</h2>
        <div style="margin-top:20px;font-size:1.1rem;opacity:0.9;">{{SUBTOPIC}}</div>
    </div>

    <!-- Today's Mission -->
    <div class="card mission-box">
        <div class="card-title">üöÄ T√§n√§√§n (Today's Mission)</div>
        <div class="mission-text">
            {{MISSION_TEXT}}
        </div>
    </div>

    <!-- Vocabulary Grid -->
    <div class="card">
        <div class="card-title">üß† Sanasto (Vocabulary)</div>
        <div class="vocab-grid">
            {{VOCAB_ITEMS}}
            <!-- Example Item Structure:
            <div class="vocab-item">
                <span class="trick-icon" title="Trick: ...">üí°</span>
                <div class="fi-word">Sana</div>
                <div class="pronunciation">[sa-na]</div>
                <div class="en-meaning">Word</div>
            </div>
            -->
        </div>
    </div>

    <!-- Grammar Theater -->
    <div class="card">
        <div class="card-title">üé≠ Kielioppiteatteri (Grammar Theater)</div>
        <div class="grammar-theater">
            {{GRAMMAR_VISUALIZATION}}
            <!-- Example: <span class="g-stem">Auto</span><span class="g-ending">ssa</span> -->
        </div>
        <div class="rule-explanation">
            {{GRAMMAR_EXPLANATION}}
        </div>

        <!-- Opettaja's Tricks -->
        <div class="tricks-box card" style="margin-top:25px;margin-bottom:0;border:none;">
            <div class="card-title" style="border:none;margin-bottom:10px;">Opettaja's Tricks</div>
            {{TRICKS_CONTENT}}
        </div>
    </div>

    <!-- Audio Section -->
    <div class="card">
        <div class="card-title">üéß Kuuntele (Listen)</div>
        <div class="audio-player" onclick="alert('Audio playing simulation...')">
            ‚ñ∂Ô∏è Play Audio Track #{{LESSON_NUMBER}}
        </div>
        <div style="margin-top:20px;">
            <h3>Script:</h3>
            <div style="background:#f9f9f9;padding:15px;border-radius:8px;margin-top:10px;font-style:italic;">
                {{AUDIO_SCRIPT}}
            </div>
        </div>
    </div>

    <!-- Exercise Zone -->
    <div class="card">
        <div class="card-title">üí™ Harjoitukset (Exercises)</div>
        {{EXERCISES}}
        <!-- 
        <div class="exercise-row">
            <label class="ex-label">1. Translate: Hello</label>
            <input type="text" class="ex-input" placeholder="Type here...">
            <button class="check-btn" onclick="checkEx(this, 'Moi')">Check</button>
        </div>
        -->
    </div>

    <!-- Writing Lab -->
    <div class="card">
        <div class="card-title">‚úçÔ∏è Kirjoituslaboratorio (Writing Lab)</div>
        <p style="margin-bottom:15px;"><strong>Task:</strong> {{WRITING_TASK}}</p>
        <textarea class="writing-area" placeholder="Kirjoita t√§h√§n (Write here)..."></textarea>
        <button class="check-btn" style="margin-top:10px;background:#2e7d32;">Save Entry</button>
    </div>

    <!-- Daily Test -->
    <div class="card">
        <div class="card-title">üß™ P√§iv√§n Testi (Daily Test)</div>
        <div id="quiz-container">
            {{QUIZ_CONTENT}}
            <!--
            <div class="accordion-item">
                <div class="accordion-header" onclick="toggleAcc(this)">1. Question? <span>+</span></div>
                <div class="accordion-content">Answer</div>
            </div>
            -->
        </div>
    </div>

    <!-- YKI Corner -->
    <div class="card" style="border:2px solid var(--fi-blue);">
        <div class="card-title">üéì YKI-nurkka (YKI Corner)</div>
        <p>{{YKI_CONTENT}}</p>
    </div>

    <!-- Footer & Progress -->
    <div class="progress-container">
        <div style="display:flex;justify-content:space-between;font-weight:700;color:var(--fi-blue);">
            <span>A1 (Start)</span>
            <span>Current: {{LEVEL}}</span>
            <span>B2 (Goal)</span>
        </div>
        <div class="progress-track">
            <div class="progress-fill"></div>
        </div>
        <p>{{PROGRESS_MESSAGE}}</p>
    </div>

    <div class="footer">
        <p>Opettaja Bot - Finnish Course<br>Next lesson auto-generates tomorrow at 20:00</p>
        <button onclick="window.print()"
            style="margin-top:10px;background:none;border:1px solid #ccc;padding:5px 10px;border-radius:4px;cursor:pointer;">üñ®Ô∏è
            Print Lesson</button>
    </div>

    <script>
        // Simple Interaction Logic
        function checkEx(btn, answer) {
            const input = btn.previousElementSibling;
            const userVal = input.value.trim().toLowerCase();
            if (userVal === answer.toLowerCase()) {
                input.style.borderColor = 'var(--accent-success)';
                btn.textContent = 'Oikein! (Correct)';
                btn.style.background = 'var(--accent-success)';
            } else {
                input.style.borderColor = 'var(--accent-error)';
                btn.textContent = 'Yrit√§ uudelleen (Try again)';
                btn.style.background = 'var(--accent-error)';
            }
        }

        function toggleAcc(header, answer) {
            const content = header.nextElementSibling;

            if (!content.innerHTML && answer) {
                content.innerHTML = answer;
            }

            const isOpen = content.style.display === 'block';
            content.style.display = isOpen ? 'none' : 'block';
            header.querySelector('span').textContent = isOpen ? '+' : '-';
        }

        // Auto-save writing
        const writingArea = document.querySelector('.writing-area');
        if (writingArea) {
            const saved = localStorage.getItem('finnish_lesson_{{LESSON_NUMBER}}_writing');
            if (saved) writingArea.value = saved;
            writingArea.addEventListener('input', (e) => {
                localStorage.setItem('finnish_lesson_{{LESSON_NUMBER}}_writing', e.target.value);
            });
        }
    </script>
</body>

</html>